{% extends 'menu.html' %}

{% block title %}Seminar{% endblock %}
{% block seminar_active %}active{% endblock %}

{% block content %}
    <form class="ui form" method="get" action="/seminar">
        <div class="inline fields">
            <div class="field">
                Search by
                <div class="ui inline dropdown">
                    <input name="search_by" value="{{ search_by }}" type="hidden">
                    <div class="text">{{ search_by }}</div>
                    <i class="dropdown icon"></i>
                    <div class="menu">
                        <div class="header">Select search field</div>
                        <div class="item" data-text="seminar">Seminar</div>
                        <div class="item" data-text="session">Session</div>
                    </div>
                </div>
            </div>
            <div class="field">
                <div class="ui search">
                    <div class="ui icon input">
                        <input name="q" class="prompt" placeholder="Search..." value="{{ q }}" type="text">
                        <i class="search icon"></i>
                    </div>
                    <div class="results"></div>
                </div>
            </div>
        </div>
    </form>
    <form class="ui form_2" method="GET" action="/problem">
        <div class="field">Sort by category
            <div class="ui select dropdown">
                <input type="hidden" name="session">
                <i class="dropdown icon"></i>
                <div class="default text">Select session</div>
                <div class="menu">
                    <div class="item" data-value="All">All</div>
                    {% if categories %}
                        {% for category in categories %}
                            <div class="item" data-value="{{ category }}">{{ category }}</div>
                        {% endfor %}
                    {% endif %}
                 </div>
            </div>
            </div>
    </form>

    {% if not seminar_dict %}
        <h2 class="first">No active or queried session exists.</h2>
    {% endif %}
    {% for session, seminars in seminar_dict.items %}
        <h2 class="ui top attached header" data-ewqqw="{{ session.title }}">{{ session.title }}</h2>
        <div class="ui bottom attached segment" data-ewqqw="{{ session.title }}">
            <div class="ui stackable three column grid">
                {% for seminar in seminars %}
                    <div class="column" data-kinux="{{ seminar.categories_title }}">
                        <div class="ui fluid card">
                            <div class="content">
                                <div class="header">{{ seminar.title }}</div>
                                <div class="meta">{{ seminar.categories_title }} - {{ seminar.author }} - {{ seminar.date }}</div>
                                <div class="description">{{ seminar.description }}</div>
                            </div>
                            {% for attachment in seminar.attachments.all %}
                                <a class="ui bottom attached button" href="{% url 'seminar:download' pk=attachment.pk %}">
                                    <i class="download icon"></i>
                                    {{ attachment }}
                                </a>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
    <script>
        $(document).ready(function () {
            var $_ui_dropdown = $('.ui.inline.dropdown');
            var $_ui_search = $('.ui.search');
            var $_ui_dropdown_category = $('.ui.select.dropdown');

            var session_list = [
                {% for session in sessions %}
                    { title: '{{ session.title }}', href: '{% url 'seminar:list' %}?search_by=session&q={{ session.title | urlencode }}' },
                {% endfor %}
            ];
            var seminar_list = [
                {% for seminar in seminars %}
                    { title: '{{ seminar.title }}', href: '{% url 'seminar:list' %}?search_by=seminar&q={{ seminar.title | urlencode }}' },
                {% endfor %}
            ];
             $_ui_dropdown_category
                .dropdown({
                    onChange: function (val)
                    {
                        var category = val;
                        if(category == "All")
                         {
                            $("div[data-kinux]").show();
                            $("div[data-ewqqw]").show();
                            $("h2[data-ewqqw]").show();
                         }
                         else {
                            $("div[data-kinux]").show();
                            $("div[data-ewqqw]").show();
                            $("h2[data-ewqqw]").show();
                            {% for cate in categories %}
                            if( category != "{{ cate }}" )
                            {
                                $("div[data-kinux='{{ cate }}']").hide();
                            }
                            else if(category == "{{ cate }}" )
                            {
                                $("div[data-kinux='{{ cate }}']").show();
                            }
                            {% endfor %}

                            var flag=0;
                            {% for i, _ in seminar_dict.items %}
                            flag=0;
                            var tmp = $("div[data-ewqqw='{{ i.title }}']").children();
                            tmp.children().each(function()
                            {
                                if($(this).is(":visible"))
                                {
                                    flag=1;
                                }
                            });
                            if(flag==0)
                            {
                                $("h2[data-ewqqw='{{ i.title }}']").hide();
                                $("div[data-ewqqw='{{ i.title }}']").hide();
                            }
                            else
                            {
                                $("h2[data-ewqqw='{{ i.title }}']").show();
                                $("div[data-ewqqw='{{ i.title }}']").show();
                            }
                            {% endfor %}
                         }
                    }
                });
            $_ui_search
                .search({
                    onSelect: function (result, response) {
                        window.location.href = result.href;
                    }
                });
            $_ui_dropdown
                .dropdown({
                    onChange: function (val) {
                        switch (val) {
                            case 'seminar':
                                $_ui_search.search('setting', 'source', seminar_list);
                                break;
                            case 'session':
                                $_ui_search.search('setting', 'source', session_list);
                                break;
                        }
                        $_ui_search.search('clear cache');
                    }
                });
            switch ($_ui_dropdown.dropdown('get value')) {
                case 'seminar':
                    $_ui_search.search('setting', 'source', seminar_list);
                    break;
                case 'session':
                    $_ui_search.search('setting', 'source', session_list);
                    break;
            }
        });
    </script>
{% endblock %}

<!-- Sort cards by session -->
